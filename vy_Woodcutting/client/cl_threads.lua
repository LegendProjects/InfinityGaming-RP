Citizen.CreateThread(function()   
    TreeEntities = {
        ---------------------------------------------------
        ------- Trees (h:1.53)
        ---------------------------------------------------

        {
            Name = 'Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Tree (Level: 1)',
            Prop = {
                Model = "prop_tree_mquite_01",
                Coords = vector3(2069.8, 5060.32, 40.51)
            },
            Coords = vector3(2069.8, 5060.32, 42.04),
            levelRequired = 1,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 2500,
            initialMin = 2,
            initialMax = 4,
            xp = 25,
            item = 'logs',
            isSpawned = false
        },

        {
            Name = 'Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Tree (Level: 1)',
            Prop = {
                Model = "prop_tree_mquite_01",
                Coords = vector3(2059.08, 5065.32, 40.27)
            },
            Coords = vector3(2059.08, 5065.32, 41.8),
            levelRequired = 1,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 2500,
            initialMin = 2,
            initialMax = 4,
            xp = 25,
            item = 'logs',
            isSpawned = false
        },

        {
            Name = 'Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Tree (Level: 1)',
            Prop = {
                Model = "prop_tree_mquite_01",
                Coords = vector3(2072.56, 5084.8, 41.79)
            },
            Coords = vector3(2072.56, 5084.8, 43.32),
            levelRequired = 1,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 2500,
            initialMin = 2,
            initialMax = 4,
            xp = 25,
            item = 'logs',
            isSpawned = false
        },

        ---------------------------------------------------
        ------- Oak Trees (h:1.74)
        ---------------------------------------------------
        {
            Name = 'Oak Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Oak Tree (Level: 15)',
            Prop = {
                Model = "prop_tree_eng_oak_01",
                Coords = vector3(-1644.04, 4582.6, 40.98)
            },
            Coords = vector3(-1644.04, 4582.6, 42.72),
            levelRequired = 15,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 3500,
            initialMin = 3,
            initialMax = 7,
            xp = 37,
            item = 'oak_logs',
            isSpawned = false
        },

        {
            Name = 'Oak Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Oak Tree (Level: 15)',
            Prop = {
                Model = "prop_tree_eng_oak_01",
                Coords = vector3(-1626.68, 4563.88, 41.62)
            },
            Coords = vector3(-1626.68, 4563.88, 43.36),
            levelRequired = 15,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 3500,
            initialMin = 3,
            initialMax = 7,
            xp = 37,
            item = 'oak_logs',
            isSpawned = false
        },

        {
            Name = 'Oak Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Oak Tree (Level: 15)',
            Prop = {
                Model = "prop_tree_eng_oak_01",
                Coords = vector3(-1645.28, 4559.92, 41.82)
            },
            Coords = vector3(-1645.28, 4559.92, 43.56),
            levelRequired = 15,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 3500,
            initialMin = 3,
            initialMax = 7,
            xp = 37,
            item = 'oak_logs',
            isSpawned = false
        },

        ---------------------------------------------------
        ------- Willow Trees (h:1.16)
        ---------------------------------------------------

        {
            Name = 'Willow Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Willow Tree (Level: 30)',
            Prop = {
                Model = "prop_tree_birch_02",
                Coords = vector3(-2096.12, 2637.88, 1.76)
            },
            Coords = vector3(-2096.12, 2637.88, 2.92),
            levelRequired = 30,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 4500,
            initialMin = 3,
            initialMax = 5,
            xp = 67,
            item = 'willow_logs',
            isSpawned = false
        },

        {
            Name = 'Willow Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Willow Tree (Level: 30)',
            Prop = {
                Model = "prop_tree_birch_02",
                Coords = vector3(-2063.6, 2626.36, 0.28)
            },
            Coords = vector3(-2063.6, 2626.36, 1.44),
            levelRequired = 30,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 4500,
            initialMin = 3,
            initialMax = 5,
            xp = 67,
            item = 'willow_logs',
            isSpawned = false
        },

        {
            Name = 'Willow Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Willow Tree (Level: 30)',
            Prop = {
                Model = "prop_tree_birch_02",
                Coords = vector3(-2061.76, 2652.12, 2.40)
            },
            Coords = vector3(-2061.76, 2652.12, 3.56),
            levelRequired = 30,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 4500,
            initialMin = 3,
            initialMax = 5,
            xp = 67,
            item = 'willow_logs',
            isSpawned = false
        },

        ---------------------------------------------------
        ------- Maple Trees (h:1.06)
        ---------------------------------------------------

        {
            Name = 'Maple Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Maple Tree (Level: 45)',
            Prop = {
                Model = "prop_tree_maple_03",
                Coords = vector3(-893.32, 5270.88, 84.89)
            },
            Coords = vector3(-893.32, 5270.88, 85.96),
            levelRequired = 45,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 5500,
            initialMin = 3,
            initialMax = 5,
            xp = 100,
            item = 'maple_logs',
            isSpawned = false
        },

        {
            Name = 'Maple Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Maple Tree (Level: 45)',
            Prop = {
                Model = "prop_tree_maple_03",
                Coords = vector3(-809.64, 5273.92, 86.82)
            },
            Coords = vector3(-809.64, 5273.92, 87.88),
            levelRequired = 45,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 5500,
            initialMin = 3,
            initialMax = 5,
            xp = 100,
            item = 'maple_logs',
            isSpawned = false
        },

        {
            Name = 'Maple Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Maple Tree (Level: 45)',
            Prop = {
                Model = "prop_tree_maple_03",
                Coords = vector3(-690.24, 5198.48, 101.3)
            },
            Coords = vector3(-690.24, 5198.48, 102.36),
            levelRequired = 45,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 5500,
            initialMin = 3,
            initialMax = 5,
            xp = 100,
            item = 'maple_logs',
            isSpawned = false
        },

        ---------------------------------------------------
        ------- Mahogany Trees (h:1.29)
        ---------------------------------------------------

        {
            Name = 'Mahogany Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Mahogany Tree (Level: 50)',
            Prop = {
                Model = "prop_tree_olive_cr2",
                Coords = vector3(419.32, 765.52, 188.51)
            },
            Coords = vector3(419.32, 765.52, 189.8),
            levelRequired = 50,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 7500,
            initialMin = 4,
            initialMax = 7,
            xp = 125,
            item = 'mahogany_logs',
            isSpawned = false
        },

        {
            Name = 'Mahogany Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Mahogany Tree (Level: 50)',
            Prop = {
                Model = "prop_tree_olive_cr2",
                Coords = vector3(391.72, 837.8, 193.27)
            },
            Coords = vector3(391.72, 837.8, 194.56),
            levelRequired = 50,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 7500,
            initialMin = 4,
            initialMax = 7,
            xp = 125,
            item = 'mahogany_logs',
            isSpawned = false
        },

        ---------------------------------------------------
        ------- Yew Trees (h:1.63)
        ---------------------------------------------------

        {
            Name = 'Yew Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Yew Tree (Level: 60)',
            Prop = {
                Model = "prop_tree_eucalip_01",
                Coords = vector3(-911.64, -752.56, 18.21)
            },
            Coords = vector3(-911.64, -752.56, 19.84),
            levelRequired = 60,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 9300,
            initialMin = 5,
            initialMax = 12,
            xp = 175,
            item = 'yew_logs',
            isSpawned = false
        },

        {
            Name = 'Yew Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Yew Tree (Level: 60)',
            Prop = {
                Model = "prop_tree_eucalip_01",
                Coords = vector3(2531.36, 4354.2, 38.76)
            },
            Coords = vector3(2531.36, 4354.2, 40.4),
            levelRequired = 60,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 9300,
            initialMin = 5,
            initialMax = 12,
            xp = 175,
            item = 'yew_logs',
            isSpawned = false
        },

        ---------------------------------------------------
        ------- Redwood Trees
        ---------------------------------------------------

        {
            Name = 'Redwood Tree',
            displayText = 'Press [~b~E~w~] to begin woodcutting.',
            actionBarText = 'Woodcutting: Redwood Tree (Level: 90)',
            Prop = {
                Model = "TEST_Tree_Forest_Trunk_01",
                Coords = vector3(2597.96, 4884.4, 34.16)
            },
            Coords = vector3(2597.96, 4884.4, 35.76),
            levelRequired = 90,
            logsRemaining = 0,
            initialLogCount = 0,
            timePerLog = 11500,
            initialMin = 9,
            initialMax = 16,
            xp = 380,
            item = 'redwood_logs',
            isSpawned = false
        },
    }
end)

---------------------------------------------------
------- ESX Intialisation
---------------------------------------------------
Citizen.CreateThread(function()
    while ESX == nil do
        TriggerEvent('iG:getSharedObject', function(obj) ESX = obj end)
        Citizen.Wait(0)
    end

    ESX.PlayerData = ESX.GetPlayerData() 

    if ESX.IsPlayerLoaded() then
        playerLoaded = true
        Citizen.Wait(5000)
        -- ESX.TriggerServerCallback('vy_Base:getPlayerSkills', function(data)
        --     woodcutting_Level = data.woodcutting_Level
        -- end)
    end

    
    SpawnTrees()
    CreateBlips()
end)
---------------------------------------------------
------- Get Player Thread
---------------------------------------------------
Citizen.CreateThread(function() -- 500 MS Loop
	while true do
		playerPed 			= GetPlayerPed(-1)
		playerPedId 		= PlayerPedId()

        playerCoords        = GetEntityCoords(playerPed)
        isInVehicle         = IsPedInAnyVehicle(playerPedId, true)
        isArmed             = IsPedArmed(playerPed, 1)
		Citizen.Wait(1000)
	end
end)

---------------------------------------------------
------- Entity Location Thread
---------------------------------------------------
Citizen.CreateThread(function()
    while true do
        Citizen.Wait(1)
        if not isInVehicle and isArmed then 
            for i=1, #TreeEntities, 1 do
                if woodcutting_Level ~= nil then
                    if TreeEntities[i].isSpawned then 
                        local dist = #(playerCoords - TreeEntities[i].Coords)
                        if dist <= 75 then
                            letSleep = false
                            local levelColour = ''
                            local levelScale = (woodcutting_Level/TreeEntities[i].levelRequired)*100 
                            local logColour = ''
                            local logScale = (TreeEntities[i].logsRemaining/TreeEntities[i].initialLogCount)*100 

                            if levelScale <= 50.99 then
                                levelColour = '~r~'
                            elseif levelScale >= 51.0 and levelScale <= 74.99 then
                                levelColour = '~o~'
                            elseif levelScale > 75 then 
                                levelColour = '~g~'
                            end 
                            
                            if logScale >= 66 then
                                logColour = '~g~'
                            elseif logScale >= 33 and logScale <= 65 then
                                logColour = '~o~'
                            elseif logScale <= 32 then 
                                logColour = '~r~'
                            end 

                            if dist <= 15 then 
                                if TreeEntities[i].Name ~= 'Redwood Tree' then 
                                    ESX.Game.Utils.DrawText3D(vector3(TreeEntities[i].Coords.x, TreeEntities[i].Coords.y, TreeEntities[i].Coords.z + 0.2), "~b~"..TreeEntities[i].Name.."~w~ ["..logColour..TreeEntities[i].logsRemaining.."~w~/"..logColour..TreeEntities[i].initialLogCount.."~w~]<br>~h~"..levelColour.."(Level: " .. TreeEntities[i].levelRequired .. ")", 0.6)
                                    if dist <= 2.5 and not isWoodcutting and isPossible and woodcutting_Level >= TreeEntities[i].levelRequired then 
                                        if GetCurrentPedWeapon(playerPed, GetHashKey("WEAPON_HATCHET"), true) or GetCurrentPedWeapon(playerPed, GetHashKey("WEAPON_DRAGONAXE"), true) then
                                            ESX.Game.Utils.DrawText3D(TreeEntities[i].Coords, 'Press [~b~E~w~] to begin woodcutting.', 0.4)
                                            if IsControlJustReleased(1,  38) and not letSleep then
                                                treeEntity = i
                                                isWoodcutting = true
                                                isCutting = true
                                                FreezeEntityPosition(playerPed, true)
                                            end
                                        end
                                    elseif dist <= 2.5 and isWoodcutting and isPossible and woodcutting_Level >= TreeEntities[i].levelRequired then  
                                        ESX.Game.Utils.DrawText3D(TreeEntities[i].Coords, 'Press [~b~E~w~] to cancel.', 0.4)
                                        if IsControlJustReleased(1,  38) then
                                            treeEntity = nil
                                            isWoodcutting = false
                                            isCutting = false
                                            FreezeEntityPosition(playerPed, false)
                                            ClearPedTasksImmediately(playerPedId)
                                        end
                                    elseif dist <= 5 and not isPossible and cooldown >= 2 and woodcutting_Level >= TreeEntities[i].levelRequired then  
                                        ESX.Game.Utils.DrawText3D(TreeEntities[i].Coords, cooldownText .. cooldown .. ' seconds..', 0.4)
                                        if IsControlJustReleased(1,  38) then
                                            treeEntity = nil
                                            isWoodcutting = false
                                            isCutting = false
                                            FreezeEntityPosition(playerPed, false)
                                            ClearPedTasksImmediately(playerPedId)
                                        end
                                    elseif dist <= 5 and not isPossible and cooldown == 1 and woodcutting_Level >= TreeEntities[i].levelRequired then  
                                        ESX.Game.Utils.DrawText3D(TreeEntities[i].Coords, cooldownText .. cooldown .. ' second..', 0.4)
                                        if IsControlJustReleased(1,  38) then
                                            treeEntity = nil
                                            isWoodcutting = false
                                            isCutting = false
                                            FreezeEntityPosition(playerPed, false)
                                            ClearPedTasksImmediately(playerPedId)
                                        end
                                    end
                                elseif TreeEntities[i].Name == 'Redwood Tree' then 
                                    ESX.Game.Utils.DrawText3D(vector3(TreeEntities[i].Coords.x, TreeEntities[i].Coords.y, TreeEntities[i].Coords.z + 0.3), "~b~"..TreeEntities[i].Name.."~w~ ["..logColour..TreeEntities[i].logsRemaining.."~w~/"..logColour..TreeEntities[i].initialLogCount.."~w~]<br>~h~"..levelColour.."(Level: " .. TreeEntities[i].levelRequired .. ")", 0.9)
                                    if dist <= 4.3 and not isWoodcutting and isPossible and woodcutting_Level >= TreeEntities[i].levelRequired then
                                        if GetCurrentPedWeapon(playerPed, GetHashKey("WEAPON_HATCHET"), true) or GetCurrentPedWeapon(playerPed, GetHashKey("WEAPON_DRAGONAXE"), true) then
                                            ESX.Game.Utils.DrawText3D(TreeEntities[i].Coords, 'Press [~b~E~w~] to begin woodcutting.', 0.7)
                                            if IsControlJustReleased(1,  38) and not letSleep then                                          
                                                treeEntity = i
                                                isWoodcutting = true
                                                isCutting = true
                                                FreezeEntityPosition(playerPed, true)
                                            end
                                        end
                                    elseif dist <= 4.3 and isWoodcutting and isPossible and woodcutting_Level >= TreeEntities[i].levelRequired then  
                                        ESX.Game.Utils.DrawText3D(TreeEntities[i].Coords, 'Press [~b~E~w~] to cancel.', 0.7)
                                        if IsControlJustReleased(1,  38) then
                                            treeEntity = nil
                                            isWoodcutting = false
                                            isCutting = false
                                            FreezeEntityPosition(playerPed, false)
                                            ClearPedTasksImmediately(playerPedId)
                                        end
                                    elseif dist <= 5 and not isPossible and cooldown >= 2 and woodcutting_Level >= TreeEntities[i].levelRequired then  
                                        ESX.Game.Utils.DrawText3D(TreeEntities[i].Coords, cooldownText .. cooldown .. ' seconds..', 0.7)
                                        if IsControlJustReleased(1,  38) then
                                            treeEntity = nil
                                            isWoodcutting = false
                                            isCutting = false
                                            FreezeEntityPosition(playerPed, false)
                                            ClearPedTasksImmediately(playerPedId)
                                        end
                                    elseif dist <= 5 and not isPossible and cooldown == 1 and woodcutting_Level >= TreeEntities[i].levelRequired then  
                                        ESX.Game.Utils.DrawText3D(TreeEntities[i].Coords, cooldownText .. cooldown .. ' second..', 0.7)
                                        if IsControlJustReleased(1,  38) then
                                            treeEntity = nil
                                            isWoodcutting = false
                                            isCutting = false
                                            FreezeEntityPosition(playerPed, false)
                                            ClearPedTasksImmediately(playerPedId)
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        else
            letSleep = true
        end

        if letSleep then 
            Citizen.Wait(1000)
        end
    end
end)


Citizen.CreateThread(function()
    while true do
        Citizen.Wait(5000)
        for i=1, #TreeEntities, 1 do
            if not TreeEntities[i].isSpawned then
                -- print('[DEBUG] [vy_Woodcutting] Spawning Tree: ' .. TreeEntities[i].Name)
                TreeEntities[i].initialLogCount = math.random(TreeEntities[i].initialMin, TreeEntities[i].initialMax)
                TreeEntities[i].logsRemaining = TreeEntities[i].initialLogCount
                TreeEntities[i].isSpawned = true
            end
        end
        Citizen.Wait(45000)
    end
end)



Citizen.CreateThread(function()
    while true do
        if isWoodcutting and isCutting then
            if treeEntity ~= nil and TreeEntities[treeEntity].logsRemaining > 0 then
                TaskPlayAnim(playerPed, "melee@hatchet@streamed_core", "plyr_front_takedown", 8.0, -8.0, -1, 0, 0, false, false, false) 
                Citizen.Wait(2200)
            end
        end
        Citizen.Wait(1)
    end
end)

Citizen.CreateThread(function()
    while true do
        if isWoodcutting and isCutting and treeEntity ~= nil then
            Citizen.Wait(TreeEntities[treeEntity].timePerLog)
            BeginWoodcutting()
        end
        if not isPossible and cooldown > 0 then 
            cooldown = cooldown - 1
            Citizen.Wait(1000)
        elseif not isPossible and cooldown == 0 then 
            isPossible = true
        end
        Citizen.Wait(1)
    end
end)

Citizen.CreateThread(function()
    while true do
        if not isPossible and cooldown > 0 then
            cooldown = cooldown - 1
            Citizen.Wait(1000)
        elseif not isPossible and cooldown == 0 then
            isBusy = false
            isPossible = true
        end
        Citizen.Wait(1)
    end
end)
